# 5x05 - Kernel Exploitation Techniques

内核漏洞利用的目标通常是获取 Root 权限并绕过 SELinux。

本章聚焦“研究视角的利用链评估”：给定一个内核 bug，如何判断其影响面、可利用性与被缓解机制阻断的位置。

## 1. 典型利用链抽象（概念级）

一条内核漏洞链路通常包含以下阶段（不依赖具体技巧）：

1. **触发与稳定复现**：在受控环境里稳定触发（避免不确定竞态）
2. **能力原语确认**：bug 能提供什么能力（越界读写、UAF、任意读写、信息泄露等）
3. **绕过/对抗缓解**：KASLR/CFI/PAN/PXN/PAC/MTE 等会在不同位置打断链路
4. **权限边界影响评估**：是否能从应用域跨到更高权限（含 SELinux domain）
5. **持久化与后续影响评估**：是否影响 boot chain、是否可跨重启、是否破坏数据完整性

这种抽象有助于把“bug 分析”与“具体可利用技巧”分离开来，更适合做漏洞定级与补丁验证。

## 2. 现代挑战
随着 CFI 和 MTE 的普及，传统的利用方式变得越来越困难，研究重点正在转向**数据流攻击 (Data-Only Attacks)**。

补充几个常见难点：

- **信息泄露更稀缺**：KASLR 与硬化检查让稳定地址泄露更难
- **控制流约束更强**：CFI/SCS/PAC 使传统控制流劫持路径成本上升
- **崩溃更早发生**：MTE/堆硬化让内存破坏更容易被检测并终止

## 3. 可利用性评估清单

在不进入具体利用细节的前提下，可利用性评估通常关注：

- **触发可控性**：输入是否可由低权限进程稳定控制
- **原语强度**：是否存在可重复的读写能力或可靠的信息泄露
- **缓解覆盖面**：目标设备是否启用关键缓解（版本/机型差异大）
- **隔离边界**：是否有 seccomp/SELinux/进程拆分把影响限制在低权限域
- **可检测性**：是否容易产生异常日志/崩溃，可否被监控侧捕获

## 4. 复现与验证（偏工程）

复现侧的目标通常是：

- 证明 bug 存在（稳定触发）
- 证明补丁有效（触发路径被修复或被硬化拦截）
- 证明影响范围（哪些版本/机型受影响）

常见证据包括：

- `dmesg`/kernel log 中的异常信息
- tombstone/堆栈
- 触发前后的系统状态差异

## 5. 关联阅读

- `/notes/android/05-kernel/04-mitigations`
- `/notes/android/05-kernel/02-selinux`
- `/notes/android/04-native/03-seccomp`

## 参考（AOSP）
- https://source.android.com/docs/security/overview/kernel-security — 内核安全机制与加固方向的官方入口，便于对照“链路被哪层打断”。
- https://source.android.com/docs/security/bulletin — 安全公告入口：用于做受影响版本范围与补丁验证的权威锚点。
